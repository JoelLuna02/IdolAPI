{"version":3,"file":"assets.routes.js","names":["_express","require","_multer","_interopRequireDefault","_Asset","_database","assets_routes","Router","store","multer","memoryStorage","upload","storage","get","req","res","connectDB","files","File","find","select","status","json","filename","params","file","findOne","original","message","set","size","mimetype","end","bytes","error","console","log","delete","findOneAndDelete","post","single","new_file","originalname","buffer","save","_default","exports","default"],"sources":["../../source/routes/assets.routes.js"],"sourcesContent":["import { Router } from \"express\";\nimport multer from \"multer\";\nimport File from \"../models/Asset\";\nimport connectDB from \"../database\";\n\nconst assets_routes = Router();\nconst store = multer.memoryStorage();\nconst upload = multer({ storage: store });\n\nassets_routes.get(\"/\", async (req, res) => {\n\tawait connectDB();\n\tconst files = await File.find().select(\"_id original mimetype updatedAt size\");\n\treturn res.status(200).json(files);\n});\n\nassets_routes.get(\"/:file\", async (req, res) => {\n\tconst filename = req.params.file;\n\ttry {\n\t\tawait connectDB();\n\t\tconst file = await File.findOne({ original: filename });\n\t\tif (!file) return res.status(404).json({ message: \"File not found!\" });\n\t\tres.set({ \"Content-Length\": file.size, \"Content-Type\": file.mimetype });\n\t\treturn res.end(file.bytes);\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\treturn res.status(500).json({ message: \"An error occurred in the query.\" });\n\t}\n});\n\nassets_routes.delete(\"/:file\", async (req, res) => {\n\tconst filename = req.params.file;\n\ttry {\n\t\tawait connectDB();\n\t\tconst file = await File.findOneAndDelete({ original: filename });\n\t\tif (!file) return res.status(404).json({ message: \"File not found!\" });\n\t\treturn res.status(204).json({});\n\t} catch (error) {\n\t\tconsole.log(error);\n\t\treturn res.status(500).json({ message: \"An error occurred in the query.\" });\n\t}\n});\n\nassets_routes.post(\"/upload\", upload.single(\"file\"), async (req, res) => {\n\tif (!req.file) return res.status(400).json({ error: \"You must specify the file to upload\" });\n\tconst new_file = req.file;\n\tawait connectDB();\n\tconst file = new File({\n\t\toriginal: new_file.originalname, // Original Name\n\t\tmimetype: new_file.mimetype, // Mimetype\n\t\tsize: new_file.size, // File size\n\t\tbytes: new_file.buffer, // file bytes\n\t});\n\tawait file.save();\n\treturn res.status(200).json({ message: \"Successfully file stored\" });\n});\n\nexport default assets_routes;\n"],"mappings":"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","ignoreList":[]}